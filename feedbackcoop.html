<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Api Connect — Feedback de Consumidores</title>

  <!-- Fuentes e iconos -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans:wght@400;500;700;900&family=Work+Sans:wght@400;500;700;900" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

  <style>
    :root{
      --primary:#f2b90d;      /* ámbar */
      --bg:#fcfbf8;           /* fondo claro */
      --surface:#ffffff;      /* tarjetas */
      --ink:#1c180d;          /* texto principal */
      --muted:#6b6b5e;        /* texto secundario */
      --border:#e8e2ce;       /* bordes suaves */
    }
    body{ background:var(--bg); color:var(--ink); font-family:"Work Sans","Noto Sans",sans-serif; }
    .chip{ border-radius:9999px; padding:2px 8px; font-size:12px; font-weight:700; }
    th.sortable{ cursor:pointer; user-select:none; }
    th.sortable .arrow{ opacity:.35; transition:transform .15s, opacity .15s; }
    th.sortable[data-dir="asc"] .arrow{ transform:rotate(180deg); opacity:1; }
    th.sortable[data-dir="desc"] .arrow{ opacity:1; }
  </style>
</head>
<body>
<div class="relative flex min-h-screen">
  <!-- Sidebar -->
  <aside class="w-80 shrink-0 bg-[var(--surface)] border-r border-[var(--border)]">
    <div class="p-4">
      <div class="flex items-center gap-3">
        <img class="h-10 w-10" alt="Api Connect" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCBybSoRkRnO6FOqzqdz6m4MgDa9-NTFYzGfl3xyGpZxg4ywb8y1HV5MNik0RtakTLFsXu7sK4DNH2UYFuLsOx_wJ7tIvxWnLI5YXMSLG2KjYNehkz9-PKpBbY6JudnSo1mC2XiOz9pHfCTvpqdoGLasuVX4IyfIWry5e70Mu-V_9I9NAHUUbtt2oXzSsVrDZ61c_4eF5k1Lvh8ZbCpuTkFIBEN0rLD32jhFBv5FirB7K4sGSppW0HO9808F4jryHghDEtsNQZpnVo"/>
        <h1 class="text-xl font-bold">Api Connect</h1>
      </div>

      <nav class="mt-8 flex flex-col gap-2">
        <a class="flex items-center gap-3 px-3 py-2 rounded-md text-[var(--muted)] hover:bg-[#f4f0e7]" href="#">
          <span class="material-symbols-outlined">dashboard</span>
          <span class="text-sm font-medium">Panel de Control</span>
        </a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-md text-[var(--muted)] hover:bg-[#f4f0e7]" href="#">
          <span class="material-symbols-outlined">groups</span>
          <span class="text-sm font-medium">Gestión de Apicultores</span>
        </a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-md bg-[color-mix(in_oklab,var(--primary) 25%,white)] text-[var(--ink)]" href="#">
          <span class="material-symbols-outlined text-[var(--primary)]">campaign</span>
          <span class="text-sm font-medium">Consolidación de Comentarios</span>
        </a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-md text-[var(--muted)] hover:bg-[#f4f0e7]" href="#">
          <span class="material-symbols-outlined">monitoring</span>
          <span class="text-sm font-medium">Análisis de Mercado</span>
        </a>
        <a class="flex items-center gap-3 px-3 py-2 rounded-md text-[var(--muted)] hover:bg-[#f4f0e7]" href="#">
          <span class="material-symbols-outlined">settings</span>
          <span class="text-sm font-medium">Configuración</span>
        </a>
      </nav>
    </div>
  </aside>

  <!-- Main -->
  <main class="flex-1 p-8">
    <header class="mb-6">
      <h2 class="text-4xl font-bold">Consolidación de Comentarios de Consumidores</h2>
      <p class="text-[var(--muted)] mt-2">Resumen de opiniones de los consumidores sobre los productos de los apicultores.</p>
    </header>

    <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
      <!-- Ranking + filtros -->
      <section class="xl:col-span-2 bg-[var(--surface)] rounded-lg border border-[var(--border)] shadow-sm overflow-hidden">
        <div class="p-6 border-b border-[var(--border)] flex flex-col lg:flex-row gap-4 lg:items-center lg:justify-between">
          <h3 class="text-xl font-bold">Ranking de Apicultores por Calificación</h3>
          <label class="relative block w-full lg:w-72">
            <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-[var(--muted)]">search</span>
            <input id="filterInput" class="form-input w-full rounded-md bg-white border-[var(--border)] pl-10 h-10" placeholder="Buscar apicultor..."/>
          </label>
        </div>

        <div class="overflow-x-auto">
          <table id="rankingTable" class="w-full text-sm text-left">
            <thead class="bg-[#faf7ee] text-[var(--ink)]">
              <tr>
                <th class="px-6 py-3 font-semibold sortable" data-col="0">Posición
                  <span class="material-symbols-outlined align-middle text-sm arrow">arrow_drop_down</span>
                </th>
                <th class="px-6 py-3 font-semibold sortable" data-col="1">Apicultor
                  <span class="material-symbols-outlined align-middle text-sm arrow">arrow_drop_down</span>
                </th>
                <th class="px-6 py-3 font-semibold sortable" data-col="2">Calificación Promedio
                  <span class="material-symbols-outlined align-middle text-sm arrow">arrow_drop_down</span>
                </th>
                <th class="px-6 py-3 font-semibold sortable" data-col="3">Número de Reseñas
                  <span class="material-symbols-outlined align-middle text-sm arrow">arrow_drop_down</span>
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-[var(--border)] bg-[var(--surface)]">
              <tr class="hover:bg-[#f9f7f0]">
                <td class="px-6 py-4 font-medium">1</td>
                <td class="px-6 py-4">Ricardo García</td>
                <td class="px-6 py-4"><span class="text-[var(--primary)]">★</span> 4.8</td>
                <td class="px-6 py-4">125</td>
              </tr>
              <tr class="hover:bg-[#f9f7f0]">
                <td class="px-6 py-4 font-medium">2</td>
                <td class="px-6 py-4">Sofía Martínez</td>
                <td class="px-6 py-4"><span class="text-[var(--primary)]">★</span> 4.7</td>
                <td class="px-6 py-4">110</td>
              </tr>
              <tr class="hover:bg-[#f9f7f0]">
                <td class="px-6 py-4 font-medium">3</td>
                <td class="px-6 py-4">Carlos López</td>
                <td class="px-6 py-4"><span class="text-[var(--primary)]">★</span> 4.6</td>
                <td class="px-6 py-4">95</td>
              </tr>
              <tr class="hover:bg-[#f9f7f0]">
                <td class="px-6 py-4 font-medium">4</td>
                <td class="px-6 py-4">Ana Rodríguez</td>
                <td class="px-6 py-4"><span class="text-[var(--primary)]">★</span> 4.5</td>
                <td class="px-6 py-4">80</td>
              </tr>
              <tr class="hover:bg-[#f9f7f0]">
                <td class="px-6 py-4 font-medium">5</td>
                <td class="px-6 py-4">Javier Pérez</td>
                <td class="px-6 py-4"><span class="text-[var(--primary)]">★</span> 4.4</td>
                <td class="px-6 py-4">70</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Reporte mercado -->
      <section class="bg-[var(--surface)] rounded-lg border border-[var(--border)] shadow-sm overflow-hidden">
        <div class="p-6 border-b border-[var(--border)]">
          <h3 class="text-xl font-bold">Reporte del Mercado</h3>
        </div>
        <div class="p-6 flex flex-col items-center text-center gap-4">
          <span class="material-symbols-outlined text-6xl text-[var(--primary)]">download_for_offline</span>
          <p class="text-[var(--muted)]">Descarga un informe detallado sobre la satisfacción general del mercado.</p>
          <button id="downloadCsvBtn" class="w-full h-10 px-4 rounded-md bg-[var(--primary)] text-[var(--ink)] text-sm font-bold hover:opacity-90 transition">
            <span class="material-symbols-outlined align-middle mr-1">file_download</span>
            Descargar Reporte (CSV)
          </button>
        </div>
      </section>
    </div>

    <!-- Resumen de comentarios -->
    <section class="mt-8 bg-[var(--surface)] rounded-lg border border-[var(--border)] shadow-sm overflow-hidden">
      <div class="p-6 border-b border-[var(--border)]">
        <h3 class="text-xl font-bold">Resumen de Comentarios</h3>
      </div>
      <div class="p-6 space-y-6">
        <!-- Comentario 1 -->
        <article class="pb-6 border-b border-[var(--border)]">
          <div class="flex items-center gap-3">
            <img class="rounded-full size-10 object-cover" alt="Elena Sánchez" src="https://lh3.googleusercontent.com/aida-public/AB6AXuByUYLj93xy0OD0NfjraitixP_VZjnRnog5z79SZ0l9gtVaXAEX0Lg1OHQna0u1iq4COYqf3HuLxxWvr1DTEue3g6xne6MsQv98WLWejYfT447h2spEVpHaIDdQbdxj93CwCUvItTY7uj4qcHLobI9QHpHDjJ9KOOOz89ZdmF80do00rgPvK0KaBbAPQbL57ojLUvmzYxlcdVfc2AX4RtTBEx6tesymuIcVu0WVYHaosRgHNWiBZQ1lyyhB9WVpNtSbuKm5zeACPHI"/>
            <div>
              <p class="font-semibold">Elena Sánchez</p>
              <p class="text-xs text-[var(--muted)]">15 de mayo de 2024</p>
            </div>
          </div>
          <div class="mt-3 flex gap-1 text-lg" aria-label="5 de 5">
            <span class="text-[var(--primary)]">★</span><span class="text-[var(--primary)]">★</span><span class="text-[var(--primary)]">★</span><span class="text-[var(--primary)]">★</span><span class="text-[var(--primary)]">★</span>
          </div>
          <p class="mt-2 text-[var(--muted)]">
            La miel de Ricardo es excepcional, con un sabor único y una textura perfecta. Definitivamente la mejor que he probado.
          </p>
          <div class="mt-3 flex gap-4 text-[var(--muted)]">
            <button class="flex items-center gap-1 hover:text-green-600"><span class="material-symbols-outlined text-lg">thumb_up</span><span>20</span></button>
            <button class="flex items-center gap-1 hover:text-red-600"><span class="material-symbols-outlined text-lg">thumb_down</span><span>2</span></button>
          </div>
        </article>

        <!-- Comentario 2 -->
        <article class="pb-6 border-b border-[var(--border)]">
          <div class="flex items-center gap-3">
            <img class="rounded-full size-10 object-cover" alt="Manuel Fernández" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCEUOu1MWIlTJH68geHWdAaPTPMFUlDPovKwvNtY629woFU7SWnzlCyADI8wewuvObEqTkRtcAzJ1z4wTBpdjPlbyN54mab6XUbOC0gmxSnGVOuAShlo6_UoLc7rOCbHZutpn-pb0W3e6PzMkQN2nScCEvxrHQNgRzVLbUIxDRDXj9MRxyZxuzIyfkGIPApMI2zVIJSuzRSiri1IglOvDwaWvU9P1u_KolqM7DL1KQVIb0yZFFtRI5CkffLKlorD7BxiCOWD08nt1Q"/>
            <div>
              <p class="font-semibold">Manuel Fernández</p>
              <p class="text-xs text-[var(--muted)]">10 de mayo de 2024</p>
            </div>
          </div>
          <div class="mt-3 flex gap-1 text-lg" aria-label="4 de 5">
            <span class="text-[var(--primary)]">★</span><span class="text-[var(--primary)]">★</span><span class="text-[var(--primary)]">★</span><span class="text-[var(--primary)]">★</span><span class="text-gray-300">★</span>
          </div>
          <p class="mt-2 text-[var(--muted)]">
            La miel de Sofía es muy buena, aunque un poco más cara que otras opciones en el mercado. La calidad justifica el precio.
          </p>
          <div class="mt-3 flex gap-4 text-[var(--muted)]">
            <button class="flex items-center gap-1 hover:text-green-600"><span class="material-symbols-outlined text-lg">thumb_up</span><span>15</span></button>
            <button class="flex items-center gap-1 hover:text-red-600"><span class="material-symbols-outlined text-lg">thumb_down</span><span>3</span></button>
          </div>
        </article>

        <!-- Comentario 3 -->
        <article>
          <div class="flex items-center gap-3">
            <img class="rounded-full size-10 object-cover" alt="Laura Gutiérrez" src="https://lh3.googleusercontent.com/aida-public/AB6AXuB_32x9CKhzWw0ENY3RkR2-fOaj2JA-VcHqUfrjjh4Ninas5tsfa3VHxzpPTp9PmGmyp4DuT9bzqVU5C6kYvSKneu3jsr4oWagk8Kyc5MQ2YQhocJvL6qFwoqJqbYoNxGNnnSk4D8uATxlHflc_WCYtPckjolDk6TAEPGbXpLuZUwZ8NnByQYM6llZaNpLveKKFVzYeiDUK4FYPSWM_Sv8hhXXfjnuoDJQjX_bY3i7bLIpCto_oPufVa8rR7-6zwrYkElAUKUjw-9Q"/>
            <div>
              <p class="font-semibold">Laura Gutiérrez</p>
              <p class="text-xs text-[var(--muted)]">5 de mayo de 2024</p>
            </div>
          </div>
          <div class="mt-3 flex gap-1 text-lg" aria-label="3 de 5">
            <span class="text-[var(--primary)]">★</span><span class="text-[var(--primary)]">★</span><span class="text-[var(--primary)]">★</span><span class="text-gray-300">★</span><span class="text-gray-300">★</span>
          </div>
          <p class="mt-2 text-[var(--muted)]">
            La miel de Carlos es decente, pero esperaba más por las buenas reseñas. El sabor es un poco común.
          </p>
          <div class="mt-3 flex gap-4 text-[var(--muted)]">
            <button class="flex items-center gap-1 hover:text-green-600"><span class="material-symbols-outlined text-lg">thumb_up</span><span>10</span></button>
            <button class="flex items-center gap-1 hover:text-red-600"><span class="material-symbols-outlined text-lg">thumb_down</span><span>5</span></button>
          </div>
        </article>
      </div>
    </section>
  </main>
</div>

<!-- Scripts: filtro, ordenamiento y CSV -->
<script>
  // Filtro por nombre de apicultor
  const filterInput = document.getElementById('filterInput');
  const rankingTable = document.getElementById('rankingTable');
  const tbody = rankingTable.querySelector('tbody');
  if(filterInput){
    filterInput.addEventListener('input', () => {
      const q = filterInput.value.toLowerCase().trim();
      [...tbody.rows].forEach(tr => {
        const name = tr.cells[1].textContent.toLowerCase();
        tr.style.display = name.includes(q) ? '' : 'none';
      });
    });
  }

  // Ordenamiento simple
  const getCellVal = (row, idx) => row.children[idx].innerText.trim();
  const asNumber = (v) => parseFloat(String(v).replace(/[^\d.-]/g,'')) || 0;

  rankingTable.querySelectorAll('th.sortable').forEach(th => {
    th.addEventListener('click', () => {
      const col = parseInt(th.dataset.col,10);
      const current = th.getAttribute('data-dir');
      const dir = current === 'asc' ? 'desc' : 'asc';
      rankingTable.querySelectorAll('th.sortable').forEach(h=>h.removeAttribute('data-dir'));
      th.setAttribute('data-dir', dir);

      const rows = [...tbody.rows].filter(r=>r.style.display!=='none');
      const numericCols = [0,2,3]; // Posición, Calificación, Reseñas
      rows.sort((a,b) => {
        const A = getCellVal(a,col);
        const B = getCellVal(b,col);
        const aVal = numericCols.includes(col) ? asNumber(A) : A.toLowerCase();
        const bVal = numericCols.includes(col) ? asNumber(B) : B.toLowerCase();
        if(aVal < bVal) return dir === 'asc' ? -1 : 1;
        if(aVal > bVal) return dir === 'asc' ? 1 : -1;
        return 0;
      });
      rows.forEach(r=>tbody.appendChild(r));
    });
  });

  // Exportar CSV del ranking
  document.getElementById('downloadCsvBtn')?.addEventListener('click', () => {
    const visibleRows = [...tbody.rows].filter(r => r.style.display !== 'none');
    const header = ["Posición","Apicultor","Calificación Promedio","Número de Reseñas"];
    const data = visibleRows.map(r => [
      r.cells[0].innerText.trim(),
      r.cells[1].innerText.trim(),
      r.cells[2].innerText.replace('★','').trim(),
      r.cells[3].innerText.trim()
    ]);
    const csv = [header, ...data].map(row =>
      row.map(v => `"${String(v).replace(/"/g,'""')}"`).join(',')
    ).join('\n');

    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'reporte_mercado.csv';
    document.body.appendChild(a); a.click();
    a.remove(); URL.revokeObjectURL(url);
  });
</script>
</body>
</html>
